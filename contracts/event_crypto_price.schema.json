{
  "$id": "https://github.com/dmytroLysh/Crypto-Market-Analytics-v0/blob/main/contracts/event_crypto_price.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CryptoPriceEvent",
  "description": "Normalized event for CoinGecko /coins/markets. One event per coin per API response.",
  "type": "object",
  "additionalProperties": false,

  "required": [
    "version",
    "source",
    "vs_currency",
    "ts_event",
    "ts_ingested",
    "coin_id",
    "symbol",
    "name",
    "current_price",
    "last_updated"
  ],

  "properties": {
    "version": {
      "type": "string",
      "const": "1.1",
      "description": "Schema version"
    },

    "source": {
      "type": "string",
      "enum": ["coingecko"],
      "description": "Upstream data source"
    },

    "vs_currency": {
      "type": "string",
      "description": "Quote currency used for this snapshot (e.g., 'usd', 'eur'). Set by producer from the request parameters."
    },

    "ts_event": {
      "type": "string",
      "format": "date-time",
      "description": "Business timestamp in UTC. Use upstream 'last_updated' (ISO8601)."
    },

    "ts_ingested": {
      "type": "string",
      "format": "date-time",
      "description": "Ingestion timestamp in UTC when producer created the event."
    },

    "coin_id": {
      "type": "string",
      "description": "CoinGecko id (e.g., 'bitcoin', 'hyperliquid'). Source: 'id'."
    },

    "symbol": {
      "type": "string",
      "description": "Lower-case ticker symbol (e.g., 'btc'). Source: 'symbol'."
    },

    "name": {
      "type": "string",
      "description": "Human-friendly coin name (e.g., 'Bitcoin'). Source: 'name'."
    },

    "image": {
      "type": ["string","null"],
      "format": "uri",
      "description": "Icon URL. Source: 'image'."
    },

    "current_price": {
      "type": "number",
      "description": "Spot price in vs_currency. Source: 'current_price'."
    },

    "market_cap": { "type": ["number","null"] },
    "market_cap_rank": { "type": ["integer","null"], "minimum": 1 },
    "fully_diluted_valuation": { "type": ["number","null"] },

    "total_volume": { "type": ["number","null"] },

    "high_24h": { "type": ["number","null"] },
    "low_24h":  { "type": ["number","null"] },

    "price_change_24h": { "type": ["number","null"] },
    "price_change_percentage_24h": { "type": ["number","null"] },

    "market_cap_change_24h": { "type": ["number","null"] },
    "market_cap_change_percentage_24h": { "type": ["number","null"] },

    "circulating_supply": { "type": ["number","null"], "minimum": 0 },
    "total_supply":       { "type": ["number","null"], "minimum": 0 },
    "max_supply":         { "type": ["number","null"], "minimum": 0 },

    "ath": { "type": ["number","null"] },
    "ath_change_percentage": { "type": ["number","null"] },
    "ath_date": { "type": ["string","null"], "format": "date-time" },

    "atl": { "type": ["number","null"] },
    "atl_change_percentage": { "type": ["number","null"] },
    "atl_date": { "type": ["string","null"], "format": "date-time" },

    "roi": {
      "type": ["object","null"],
      "additionalProperties": false,
      "required": ["times","currency","percentage"],
      "properties": {
        "times": { "type": "number" },
        "currency": { "type": "string" },
        "percentage": { "type": "number" }
      },
      "description": "ROI object as returned by CoinGecko for some coins; often null."
    },

    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "Upstream 'last_updated' as-is (ISO8601, UTC)."
    },

    "price_change_percentage_1h_in_currency":  { "type": ["number","null"] },
    "price_change_percentage_24h_in_currency": { "type": ["number","null"] },
    "price_change_percentage_7d_in_currency":  { "type": ["number","null"] }
  }
}
